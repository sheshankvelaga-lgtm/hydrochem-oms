<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hydro Chem Industries - Order Management</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Hydro Chem Industries - Order Management</h1>
      <div class="user-info">
        <button id="refreshButton" onclick="refreshData()" style="display:none;">🔄 Refresh</button>
        <span id="userEmail"></span>
        <button id="authButton" onclick="handleAuthClick()">Sign In</button>
        <button id="signoutButton" onclick="handleSignoutClick()" style="display:none;">Sign Out</button>
      </div>
    </div>
  </header>

  <!-- Search Bar with Owner Filter -->
  <section id="searchBar" class="search-bar" style="display:none;">
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="🔍 Search by Order ID, Deal, Customer, GST, LR..." />
      
      <select id="statusFilter">
        <option value="all">All Statuses</option>
        <option value="placed">📝 Order Placed</option>
        <option value="in_progress">⚙️ In Progress</option>
        <option value="shipped">🚚 Shipped</option>
        <option value="delivered">✅ Delivered</option>
        <option value="cancelled">❌ Cancelled</option>
      </select>

      <select id="ownerFilter">
        <option value="all">All Owners</option>
        <!-- Will be populated dynamically -->
      </select>
      
      <button class="btn-search" onclick="performSearch()">Search</button>
      <button class="btn-clear" onclick="clearSearch()">Clear</button>
    </div>
  </section>

  <section id="orderForm" class="order-form" style="display:none;">
    <h2>Create New Order</h2>
    
    <div class="form-grid">
      <label>
        Deal <span class="required">*</span>
        <select id="dealSelect" required>
          <option value="">Select a deal...</option>
        </select>
      </label>

      <label>
        Customer Address <span class="required">*</span>
        <textarea id="addressInput" rows="2" placeholder="Full address" required></textarea>
      </label>

      <label>
        GST Number <span class="required">*</span>
        <input type="text" id="gstInput" placeholder="e.g., 27AAAAA0000A1Z5" required />
      </label>

      <label>
        Discount Code
        <input type="text" id="discountInput" placeholder="Optional" />
      </label>

      <label>
        LR Number
        <input type="text" id="lrInput" placeholder="Lorry Receipt number" />
      </label>

      <label>
        Custom Field 1
        <input type="text" id="custom1Input" placeholder="For future use" />
      </label>

      <label>
        Custom Field 2
        <input type="text" id="custom2Input" placeholder="For future use" />
      </label>
    </div>

    <div class="product-list">
      <h3>Products <span class="required">*</span></h3>
      <div id="productItems">
        <div class="product-item" data-product-index="0">
          <label>
            Product
            <select class="product-select" required>
              <option value="">Select product...</option>
            </select>
          </label>
          <label>
            Volume (Liters)
            <input type="number" class="volume-input" min="1" step="0.1" placeholder="e.g., 100" required />
          </label>
          <button type="button" class="btn-remove" onclick="removeProduct(0)" style="display:none;">✕</button>
        </div>
      </div>
      <button type="button" class="btn-add-product" onclick="addProductRow()">+ Add Another Product</button>
    </div>

    <button id="createOrderBtn" onclick="createOrder()" class="btn-primary">
      ➕ Create Order
    </button>
  </section>

  <section id="kanban" class="kanban-board">
    <div class="column">
      <div class="column-header placed">
        <h3>📝 Order Placed</h3>
        <span class="count" id="count-placed">0</span>
      </div>
      <div class="lane" id="lane-placed" data-status="placed"></div>
    </div>

    <div class="column">
      <div class="column-header progress">
        <h3>⚙️ In Progress</h3>
        <span class="count" id="count-in_progress">0</span>
      </div>
      <div class="lane" id="lane-in_progress" data-status="in_progress"></div>
    </div>

    <div class="column">
      <div class="column-header shipped">
        <h3>🚚 Shipped</h3>
        <span class="count" id="count-shipped">0</span>
      </div>
      <div class="lane" id="lane-shipped" data-status="shipped"></div>
    </div>

    <div class="column">
      <div class="column-header delivered">
        <h3>✅ Delivered</h3>
        <span class="count" id="count-delivered">0</span>
      </div>
      <div class="lane" id="lane-delivered" data-status="delivered"></div>
    </div>

    <div class="column">
      <div class="column-header cancelled">
        <h3>❌ Cancelled</h3>
        <span class="count" id="count-cancelled">0</span>
      </div>
      <div class="lane" id="lane-cancelled" data-status="cancelled"></div>
    </div>
  </section>

  <!-- Order Detail Modal -->
  <div id="orderModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Order Details</h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Populated by JavaScript -->
      </div>
      
      <!-- Order Notes Section -->
      <div class="modal-notes" id="notesSection">
        <h3>📝 Order Notes</h3>
        <div id="notesList" class="notes-list">
          <!-- Notes will be loaded here -->
        </div>
        <div class="note-input-area">
          <textarea id="noteInput" placeholder="Add a note..." rows="3"></textarea>
          <button class="btn-add-note" onclick="addNote()">💬 Add Note</button>
        </div>
      </div>

      <!-- Attachments Section -->
      <div class="modal-attachments" id="attachmentsSection">
        <h3>📎 Attachments</h3>
        <div id="attachmentsList" class="attachments-list">
          <!-- Attachments will be loaded here -->
        </div>
        <div class="attachment-upload">
          <input type="file" id="fileInput" multiple style="display:none;" onchange="handleFileSelect(event)" />
          <button class="btn-upload" onclick="document.getElementById('fileInput').click()">📎 Upload Files</button>
          <span id="uploadStatus" class="upload-status"></span>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
  <script src="app.js"></script>
</body>
</html>
